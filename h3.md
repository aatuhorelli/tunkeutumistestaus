# H3 - Fuff faster

Tehtävänannot luettavissa: https://terokarvinen.com/2024/eettinen-hakkerointi-2024/

## X) Tiivistelmät

### Find Hidden Web Directories - Fuzz URLs with ffuf
 - Fuff on joohoin kehittämä web-fuzzeri, jolla voi fuzzata mm.:
   - Palvelinten piilotetut hakemistot
   - Headerit
   - POST-parametrit

 - Tero Karvisen harjoitusmaalin(dirfuzt-0) lataus ja käynnistäminen:
   ````   
    $ wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-0
    $ chmod u+x dirfuzt-0
    $ ./dirfuzt-0
    Learn more at TeroKarvinen.com
    http://127.0.0.2:8000
   ````
 - Fuff lataus, purkaminen ja käynnistys:
   ````
   $ wget https://github.com/ffuf/ffuf/releases/download/v2.0.0/ffuf_2.0.0_linux_amd64.tar.gz
   $ tar -xf ffuf_2.0.0_linux_amd64.tar.gz
   $ ./ffuf
   Fuzz Faster U Fool - v2.0.0
   ````
 - Sanalistojen lataus (esim. Daniel Miesslerin Seclists): ``$ wget https://raw.githubusercontent.com/danielmiessler/SecLists/master/Discovery/Web-Content/common.txt``
 - Fuff käyttö: ``$ ./fuff -w common.txt -u http://127.0.0.2:8000/FUZZ``
   - ``./fuff``: ajaa fuffin työhakemistosta
   - ``-w common.txt``: käytettävä sanalista. Oma huomio: omaan muuttujaansa määrittely myös mahdollista, esim. ``-w common.txt:PASSWORD``
   - ``-u http://127.0.0.2:8000/FUZZ``: Fuzzauksen kohde on ip-osoite 127.0.0.2 portissa 8000. 'FUZZ' korvataan sanalistan sanoilla yksi kerrallaan. 
 - Hyödyllisiä parametreja tulosten suodattamiseen:
   - ``-fc``: HTTP status, esim 200
   - ``-fs``: vastauksen koko tavuina. Esimerkkikäyttö: ``$ ./ffuf -w common.txt -u http://127.0.0.2:8000/FUZZ -fs 132`` poistaa tuloksista 132 tavun kokoiset osumat.
   - ``-fw``: Sanojen määrä.
   - ``-fl``: Rivien määrä.
   - ``-ft``: Vastauksen viive millisekunteina.
  
- Hyödyllisiä linkkejä:
  - Fuff kotisivu: https://github.com/ffuf/ffuf
  - Lisää sanalistoja:
    - MiessLer, Haddix, g0tmi1k: SecLists: https://github.com/danielmiessler/SecLists

Lähde: Terokarvinen.com. https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/

### Cracking Passwords with Hashcat

 - Järjestelmät tallentavat salasanat tiivisteinä
   - Tiivisteistä ei voida laskea auki alkuperäistä salasanaa, vaan se pitää selvittää vertailemalla sanakirjan pohjalta generoituja tiivisteitä alkuperäiseen. Tähän voidaan käyttää esim. Hashcatia

 #### Hashcatin asennus
 
 - Asennus: ``sudo apt-get -y install hashid hashcat wget``
 - Luo hakemisto tiivisteiden työstämiseen: ``$ mkdir hashed``
 - Sanakirjan lataus, esim. Rockyou: ``wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz``
   - Purkaminen: ``$ tar xf rockyou.txt.tar.gz``
   - Sisältää ~14 miljoonaa sanaa

  #### Tiivisteen murtaminen

  - Tiivisteen tyyppi pitää olla tiedossa ennen murtamista. Voidaan yrittää selvittää hashid:llä ``$ hashid -m [tiiviste]``
    - Hashcat Mode -tieto käytettävissä suoraan hashcatissa. Esim. MD5 [Hashcat Mode: 0] --> ``$ hashcat -m 0 ...`` määrittää tiivisteen tyypiksi MD5
  - Hashcatin käyttö: ``$ hashcat -m 0 '6b1628b016dff46e6fa35684be6acc96' rockyou.txt -o solved``
    - ``hashcat``: hashcat-ohjelma
    - ``-m 0``: tiivisteen tyyppi, selvitettävissä esim. hashid:llä
    - ``'6b1628b016dff46e6fa35684be6acc96'``: murrettava tiiviste. Heittomerkit ympärille erikoismerkkien varalta.
    - ``-o solved``: Output. Tallentaa tiivisteen ja sitä vastaavan salasanan "solved"-nimiseen tiedostoon
      - Jos outputia ei käytetä, saa murretut tiivisteet näytettyä korvaamalla ``-o`` -->  ``--show``

Lähde: Terokarvinen.com. https://terokarvinen.com/2022/cracking-passwords-with-hashcat/
  
### Crack File Password With John

 - John the Ripperiä voidaan käyttää tiedostojen salasanojen murtamiseen sanakirjahyökkäyksellä
 - Tarvittavien työkalujen ja kirjastojen asennus:
  - ````
    $ sudo apt-get update
    $ sudo apt-get -y install micro bash-completion git build-essential libssl-dev zlib1g zlib1g-dev zlib-gst libbz2-1.0 libbz2-dev atool zip wget
    ````
 - John the Ripperin kloonaus Gitistä: ``$ git clone --depth=1 https://github.com/openwall/john.git # --depth=1 vapaaehtoinen``
 - Konfigurointi ja kääntäminen:
   - ``$ cd john/src/`` & ``$ ./configure``. Mainitsee mahdollisesti puuttuvista riippuvuuksista, jotka tulee vielä asentaa.
   - ``$ make -s clean && make -sj4``. Voi kestää joitain minuutteja. Vaatii jonkin verran RAMia, joten ei välttämättä toimi kevyimmillä virtuaalikoneilla.
     - Luo /john/-hakemistoon ajettavia tiedostoja ja scriptejä
 - Käyttö: ``$ $HOME/john/run/john``
   - Kaksivaiheinen prosessi (esimerkkinä zip-tiedosto):
     - Ensin haetaan salatun tiedoston tiiviste omaan tiedostoonsa: ``$ $HOME/john/run/zip2john > tiedostonimi.zip.hash``
     - Tiivisteen purkaminen sanakirjahyökkäyksellä: ``$ $HOME/john/run/john tiedostonimi.zip.hash``
    
 - Muuta:
   - /run/-hakemistossa ajettavia tiedostoja eri tiedostomuotojen tiivisteiden hakemiseen
   - Tarvittaessa tehtävä symlink pythonin ja python3 välille: ``$ sudo ln -s /usr/bin/python3 /usr/local/bin/python``
 
Lähde: Terokarvinen.com. https://terokarvinen.com/2023/crack-file-password-with-john/


## A) Hashcatin asennus ja testaus

Aloitin päivittämällä paketinhallinnan listat ``$ sudo apt-get update``, minkä jälkeen testasin, oliko Hashcat jo asennettuna. Komento ``$ hashcat`` tulosti Hashcatin ohjeita, joten asennusta ei tarvinnut erikseen tehdä. 

````
$ hashcat            
Usage: hashcat [options]... hash|hashfile|hccapxfile [dictionary|mask|directory]...

Try --help for more help.
````
Loin seuraavaksi kotihakemistooni kansion viikon tehtäville. ``$ mkdir /home/aatu/h3/hashcat/`` ja latasin Rockyou-sanakirjan Githubista luomaani hakemistoon komennolla ``$ wget https://github.com/danielmiessler/SecLists/raw/master/Passwords/Leaked-Databases/rockyou.txt.tar.gz``. Purin tiedoston ``$ tar xf rockyou.txt.tar.gz``, tarkistin puretun tiedoston sisällön ``$ head rockyou.txt`` ja poistin tämän jälkeen aiemmin lataamani pakatun tiedoston ``$ rm rockyou.txt.tar.gz``.

![Add file: Rockyou lataus](/img/h3/hashcat_sanakirja.png)
> Rockyou-sanakirjan lataus, purkaminen ja ensimmäisten rivien tarkastelu

Tutustuin jälkeenpäin SecListsin [GitHub-sivuun](https://github.com/danielmiessler/SecLists/), ja huomasin, että kaikki sanakirjat oli mahdollista ladata Kaliin komennolla ``$ sudo apt-get install seclists``. Latasin loputkin sanakirjat, minkä jälkeen ne löytyivät hakemistosta ``/usr/share/seclists``. 

Testasin Tero Karvisen [Hashcat-artikkelissa](https://terokarvinen.com/2022/cracking-passwords-with-hashcat/) käytetyn esimerkkitiivisteen purkamista. Analysoin ensin hashid:n avulla tiivisteen tyypin:

````
$ hashid -m 6b1628b016dff46e6fa35684be6acc96
Analyzing '6b1628b016dff46e6fa35684be6acc96'
[+] MD2 
[+] MD5 [Hashcat Mode: 0]
[+] MD4 [Hashcat Mode: 900]
[+] Double MD5 [Hashcat Mode: 2600]
[+] LM [Hashcat Mode: 3000]
[+] RIPEMD-128 
[+] Haval-128 
[+] Tiger-128 
[+] Skein-256(128) 
[+] Skein-512(128) 
[+] Lotus Notes/Domino 5 [Hashcat Mode: 8600]
[+] Skype [Hashcat Mode: 23]
[+] Snefru-128 
[+] NTLM [Hashcat Mode: 1000]
[+] Domain Cached Credentials [Hashcat Mode: 1100]
[+] Domain Cached Credentials 2 [Hashcat Mode: 2100]
[+] DNSSEC(NSEC3) [Hashcat Mode: 8300]
[+] RAdmin v2.x [Hashcat Mode: 9900]
````

Ohjeen mukaan tiivisteen tyyppi on useimmiten jokin ensimmäisestä kolmesta listatusta, ja osittain itsekin pääteltävissä tiivisteen lähdejärjestelmästä. Hashcatille määritellään tiivisteen tyyppi hashid:n ehdottaman Hashcat Moden mukaan, esim Hashcat Mode: 0 --> ``$ hashcat -m 0 [tiiviste]``. Usutin Hashcatin tiivisteen kimppuun rockyou-sanalistan kanssa käyttäen MD5-tiivisteen tyyppiä '0'. Ratkaistun tiiviste-sanaparin tulostin outputilla ``-o [tiedostonimi]``.

Alla ajettu komento ja osa tulosteista analysoituna:

````
$ hashcat -m 0 '6b1628b016dff46e6fa35684be6acc96' rockyou.txt -o ratkaistu # Ajettu komento
hashcat (v6.2.6) starting

OpenCL API (OpenCL 3.0 PoCL 5.0+debian  Linux, None+Asserts, RELOC, SPIR, LLVM 15.0.7, SLEEF, DISTRO, POCL_DEBUG) - Platform #1 [The pocl project]
==================================================================================================================================================
* Device #1: cpu-haswell-12th Gen Intel(R) Core(TM) i7-1255U, 6792/13648 MB (2048 MB allocatable), 12MCU # Laitteen tietoja (CPU / RAM)
[...]
Dictionary cache built:
* Filename..: rockyou.txt # Käytetty sanakirja
* Passwords.: 14344391 # Sanojen määrä rockyou.txt-tiedostossa
* Bytes.....: 139921497 # Tiedoston koko tavuina
* Keyspace..: 14344384
* Runtime...: 1 sec # Murtamiseen käytetty aika: 1 sekunti.

                                                          
Session..........: hashcat
Status...........: Cracked # Murtaminen onnistui
Hash.Mode........: 0 (MD5)
Hash.Target......: 6b1628b016dff46e6fa35684be6acc96 # Murrettava tiiviste
Time.Started.....: Sat Apr 20 23:59:23 2024 (0 secs) # Aloitusajankohta
Time.Estimated...: Sat Apr 20 23:59:23 2024 (0 secs) # Ilmeisesti arvio siitä, kauanko purkaminen kestäisi (0 sekuntia)
Kernel.Feature...: Pure Kernel
Guess.Base.......: File (rockyou.txt) 
Guess.Queue......: 1/1 (100.00%)
Speed.#1.........:   334.9 kH/s (0.30ms) @ Accel:1024 Loops:1 Thr:1 Vec:8
Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)
Progress.........: 12288/14344384 (0.09%) # 0.09% listasta käyty läpi ennen osuman löytymistä. Rivit 1-12288 (sanat: 123456 -> havana)
Rejected.........: 0/12288 (0.00%)
Restore.Point....: 0/14344384 (0.00%)
Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1
Candidate.Engine.: Device Generator
Candidates.#1....: 123456 -> havana # Testattu väli sanakirjasta
Hardware.Mon.#1..: Temp: 57c Util:  8% # Prosessorin lämpötila ja kuorma. Lämmöt normaalit, 8% käyttöaste. 

Started: Sat Apr 20 23:59:08 2024
Stopped: Sat Apr 20 23:59:24 2024
````
Tiivisteen murtaminen onnistui (Status: Cracked) sekunnissa, ja output-tiedosto 'ratkaistu' sisälsi tiivisteen ja sitä vastaavan sanan:

````
$ cat ratkaistu                  
6b1628b016dff46e6fa35684be6acc96:summer
````

## B) Salainen, mutta ei multa

Latasin ja käynnistin Tero Karvisen [dirfuzt-0 -harjoitusmaalin](https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/):
````
$ wget https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/dirfuzt-0 # Harjoitusmaalin lataus wgetillä
$ chmod u+x dirfuzt-0 # Suoritusoikeuden lisäys käyttäjälle (u = user, x = execute)
$ ./dirfuzt-0 # Harjoitusmaalin käynnistys
Learn more at TeroKarvinen.com
http://127.0.0.2:8000
````
Testasin selaimella, että harjoitusmaali on onnistuneesti käynnistetty siirtymällä osoitteeseen 127.0.0.2:8000.

![Add file: dirfuzt päällä](/img/h3/dirfuzt_asennus.png)
> Sivu aukeaa ja näyttää oikealta. Alla terminaalissa ajetut komennot.


## Lähteet: 

https://terokarvinen.com/2024/eettinen-hakkerointi-2024/
Terokarvinen.com. https://terokarvinen.com/2023/fuzz-urls-find-hidden-directories/
Terokarvinen.com. https://terokarvinen.com/2022/cracking-passwords-with-hashcat/
Terokarvinen.com. https://terokarvinen.com/2023/crack-file-password-with-john/
