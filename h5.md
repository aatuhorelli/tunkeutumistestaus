# H5 - Täysin Laillinen Sertifikaatti

Tehtävänannot luettavissa: https://terokarvinen.com/2024/eettinen-hakkerointi-2024/

## X) Lue ja tiivistä

### OWASP 2021: OWASP Top 10:2021

#### A01:2021 - Broken Access Control


 - Access Controllin tarkoituksena on valvoa, että käyttäjät toimivat valtuuksiensa puitteissa.
 - Epäonnistuessaan mahdollistaa tiedon vuotamisen, muokkauksen tai tuhoutumisen, sekä käyttäjien oikeuksien ulkopuolisen toiminnan.
 - Tehokas vain, jos hyökkääjä ei voi muokata AC:n tarkistuksia tai metadataa

##### Yleisiä access control -haavoittuvuuksia:

 - Least privilege -periaatteen puuttuminen
 - AC:n ohittaminen muokkaamalla:
    - URLia (parameter tampering / force browsing)
    - Sovelluksensisäisiä tiloja
    - HTML-sivua
    - Muokatuilla API-pyynnöillä
 - Katselun/muokkauksen salliminen toiselle käyttäjälle UID:ta hyödyntäen (insecure direct object references)
 - Rajapinnan puutteelliset kontrollit POST/PUT/DELETElle
 - Käyttöoikeuksien lisääminen (elevation of privilege) 

##### Ennaltaehkäisy:

 - Vain julkiset resurssit saataville (deny by default)
 - Webbipalvelimen hakemistolistauksen poiskytkentä
 - Lokitus & hälytykset
 - Istuntotunnisteiden invalidointi uloskirjautuessa

Lähde: https://owasp.org/Top10/A01_2021-Broken_Access_Control/

#### A10:2021 - Server Side Request Forgery (SSRF)

 - Jos käyttäjän syöttämää URLia ei validioida, hyökkääjän on mahdollista saada pääsy piilotettuihin tiedostoihin
   - Esim. ``file:///etc/passwd``
 - Arkkitehtuurin monimutkaistuessa ja pilvipalveluiden yleistyessä myös SSRF:n vakavuus korostunut

#### Ennaltaehkäisy

 - Toiminnallisuuksien segmentointi omiin verkkoihinsa
 - 'Deny by default' -palomuurisäännöt
 - Käyttäjän syötteiden validiointi
 - HTTP-uudelleenohjaus pois
 - Käyttäjille ei lähetetä vastauksissa raakadataa

Lähde: https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/

### PortSwigger Academy

#### Insecure direct object references (IDOR)

 - AC:n haavoittuvuus, jossa käyttäjä voi URLia muokkaamalla päästä käsiksi tälle tarkoittamattomiin tietoihin
   - Esim. tietokantahaut: https://insecure-website.com/customer_account?customer_number=132355
     - customer_numberia muokkaamalla mahdollistaa muiden asiakkaiden tietoihin pääsyn
   - Staattiset tiedostot: https://insecure-website.com/static/12144.txt

Lähde: https://portswigger.net/web-security/access-control/idor

#### Path Traversal

 - Mahdollistaa hyökkääjälle pääsyn tiedostoihin hakemistopolun perusteella
   - ``../../../`` siirtyy kolme hakemistoa juurta kohti
   - Absoluuttista polkua käyttämällä voidaan toisinaan ohittaa suojauksia: ``filename=/etc/passwd``.
   - Palvelun vaatiessa tietynlaista tiedostomuotoa, voidaan se kiertää null bytellä: ``filename=../../../etc/passwd%00.png``
   - Joissain tapauksissa myös tiedostoihin kirjoittaminen mahdollista
 - Esim:
   - ``<img src="/loadImage?filename=218.png">`` hakee tiedoston polusta ``/var/www/images/218.png``
   - ``https://insecure-website.com/loadImage?filename=../../../etc/passwd`` lukee tiedoston ``/var/www/images/../../../etc/passwd``
 - Ennaltaehkäisy: käyttäjän syötteiden validiointi (erikoismerkit kielletty), kohdetiedoston polun tarkastaminen ennen lähettämistä


Lähde: https://portswigger.net/web-security/file-path-traversal

#### Server-side template injection

 - Mahdollistaa haitallisen injektion palvelimella suoritettavaan koodiin
   - Vakavimmillaan koko palvelimen haltuunotto mahdollinen
 - Aiheutuu, jos käyttäjän syöte yhdistetään templateihin sellaisenaan sen sijaan, että se lähetettäisiin tietona. (concatenate)
 - Hyökkäyksen rakenne: Detect, identify, exploit.
   - Detect:
     - Erikoismerkkejä syöttämällä (``${{<%[%'"}}%\``) aiheutuneet virheet voivat viitata siihen, että syötettä on käsitelty templatessa.
     - Matemaattisen kaavan syöttö: ``http://vulnerable-website.com/?username=${7*7}`` --> 'Hello 49'
     - Sekoitetaan toisinaan XSS:ään, mutta testattavissa HTML-tageja syöttämällä: ``http://vulnerable-website.com/?greeting=data.username<tag>`` --> Hello Carlos<tag>
   - Identify:
     - Templateja toteutettu useilla eri kielillä. Hyökkäyksen onnistumiseksi tämä tulee tunnistaa.
     - Virheellisen syntaksin syötteiden aiheuttamat virheilmoitukset, esim: ``<%=foobar%>``
     - Muita syötteitä: ``${7*7}``, ``{{7*7}}``, ``{{7*'7'}}``
   - Exploit:
     - Valitaan templatelle sopiva hyökkäys
 - Ennaltaehkäisy:
   - Estä käyttäjiä luomasta tai muokkaamasta templateja
   - "logic-less" template, esim. Mustachen käyttö
   - Logiikka- ja esityskerrosten eriyttäminen
   - Hiekkalaatikoiden tai dockerin käyttö

Lähde: https://portswigger.net/web-security/server-side-template-injection

#### Server-side request forgery (SSRF)

https://portswigger.net/web-security/ssrf

#### Cross-site scripting (XSS)

https://portswigger.net/web-security/cross-site-scripting

### Terokarvinen.com - Try Webhacking on New Webgoat 2023.4

https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/

## A) Totally Legit Certificate

## B) Kettumaista

## C) PortSwigger Labs - Insecure direct object references

## D) PortSwigger Labs - File path traversal, simple case

## E) PortSwigger Labs - File path traversal, traversal sequences blocked with absolute path bypass

## F) PortSwigger Labs - File path traversal, traversal sequences stripped non-recursively

## G) PortSwigger Labs - Server-side template injection with information disclosure via user-supplied objects

## H) PortSwigger Labs - Basic SSRF against the local server

## I) PortSwigger Labs - Reflected XSS into HTML context with nothing encoded

## J) PortSwigger Labs - Stored XSS into HTML context with nothing encoded

## K) WebGoat 2023.4 asennus

## L) Pencode

## M) WebGoat 2023.4 - (A1) Broken Access Control

## N) WebGoat 2023.4 - (A7) Identity & Auth Failure

## O) WebGoat 2023.4 - (A10) Server-side Request Forgery

## P) WebGoat 2023.4 - Client side

## Lähteet

Tero Karvinen, 2024. https://terokarvinen.com/2024/eettinen-hakkerointi-2024/

https://owasp.org/Top10/A01_2021-Broken_Access_Control/
https://owasp.org/Top10/A10_2021-Server-Side_Request_Forgery_%28SSRF%29/
https://portswigger.net/web-security/access-control/idor
https://portswigger.net/web-security/file-path-traversal
https://portswigger.net/web-security/server-side-template-injection
https://portswigger.net/web-security/ssrf
https://portswigger.net/web-security/cross-site-scripting
https://terokarvinen.com/2023/webgoat-2023-4-ethical-web-hacking/
